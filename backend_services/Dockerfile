FROM balenalib/raspberry-pi-debian-python:latest

WORKDIR /opt/app/

COPY *.py requirements.txt ./

ARG PORT_BIND=8090
ARG POSTGRES_PASSWORD
ARG RABBITMQ_DEFAULT_PASS
ARG TWILIO_ACCOUNT_SID
ARG TWILIO_AUTH_TOKEN
ARG TWILIO_PHONE_NUMBER
ARG USERS_PHONE_NUMBER


ENV PORT_BIND=${PORT_BIND}
ENV TIMEZONE=America/Chicago
ENV DB_NAME=iotdata
ENV POSTGRES_USER=postgres
ENV RABBITMQ_DEFAULT_USER=RABBITMQ_DEFAULT_USER

ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV RABBITMQ_DEFAULT_PASS=${RABBITMQ_DEFAULT_PASS}
ENV TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}
ENV TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}
ENV TWILIO_PHONE_NUMBER=${TWILIO_PHONE_NUMBER}
ENV USERS_PHONE_NUMBER=${USERS_PHONE_NUMBER}

ENV ENVIRONMENT=production

RUN apt-get update
RUN apt-get install -y python3-opencv
RUN pip install -r ./requirements.txt

CMD ["python", "./run.py"]

EXPOSE ${PORT_BIND}